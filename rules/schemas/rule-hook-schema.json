{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://vibe-codex.com/schemas/rule-hook/v1.0.0",
  "title": "Vibe Codex Rule/Hook Definition",
  "description": "Schema for defining rules and hooks in vibe-codex",
  "type": "object",
  "required": ["version", "id", "type", "metadata", "implementation"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version",
      "enum": ["1.0"]
    },
    "id": {
      "type": "string",
      "description": "Unique identifier for the rule/hook",
      "pattern": "^[a-z0-9-]+$"
    },
    "type": {
      "type": "string",
      "description": "Whether this is a rule or hook",
      "enum": ["rule", "hook"]
    },
    "platforms": {
      "type": "array",
      "description": "Platforms this rule/hook supports",
      "items": {
        "type": "string",
        "enum": ["git", "claude", "github-copilot", "cursor", "all"]
      },
      "minItems": 1,
      "uniqueItems": true
    },
    "compatibility": {
      "type": "object",
      "description": "Compatibility requirements",
      "properties": {
        "os": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["windows", "linux", "macos", "all"]
          }
        },
        "shells": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["bash", "powershell", "cmd", "zsh", "fish"]
          }
        },
        "requirements": {
          "type": "array",
          "description": "Required tools and versions",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "required": ["name", "description", "category"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable name"
        },
        "description": {
          "type": "string",
          "description": "Detailed description of what this rule/hook does"
        },
        "category": {
          "type": "string",
          "enum": ["security", "workflow", "quality", "documentation", "ai-development", "llm-specific"]
        },
        "severity": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"],
          "default": "medium"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "enabled_by_default": {
          "type": "boolean",
          "default": false
        }
      }
    },
    "implementation": {
      "type": "object",
      "description": "Platform-specific implementations",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "hooks": {
            "type": "array",
            "description": "Hook types this applies to",
            "items": {
              "type": "string"
            }
          },
          "script": {
            "type": "string",
            "description": "Path to script file (relative to rules/scripts/)"
          },
          "command": {
            "type": "string",
            "description": "Command to execute"
          },
          "validator": {
            "type": "string",
            "description": "JavaScript validator function name"
          },
          "config": {
            "type": "object",
            "description": "Platform-specific configuration"
          },
          "files": {
            "type": "array",
            "description": "File patterns to check",
            "items": {
              "type": "string"
            }
          }
        }
      }
    },
    "options": {
      "type": "object",
      "description": "Configurable options for this rule/hook",
      "additionalProperties": true
    }
  }
}